name: Lint and Test

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  golangci-lint:
    runs-on: ubuntu-latest
    env:
      GOPATH: /home/runner/work/apptio/kr8/go
    steps:
    - uses: actions/checkout@v2
      with:
        path: 'go/src/github.com/apptio/kr8'
    - name: Run
      uses: actions-contrib/golangci-lint@v1
      with:
        working-directory: go/src/github.com/apptio/kr8
        args: run --config=go/src/github.com/apptio/kr8/.golangci.yml ./...

  test:
    name: test
    runs-on: ubuntu-latest
    steps:
    - name: Setting up BATS
      run: sudo npm install -g bats
    - name: Check out code
      uses: actions/checkout@v1
    - name: Running tests
      run: |
        cd bats-test
        bats -r cluster_test.sh
